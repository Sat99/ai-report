
<!DOCTYPE html>
<html>
<head>
<title>Sales Data Analysis Report</title>
<style>
body { font-family: sans-serif; }
table { width: 100%; border-collapse: collapse; }
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
th { background-color: #f2f2f2; }
.positive { color: green; }
.negative { color: red; }
.doh-critical { background-color: #ffcccc; } /* Light red for critical DOH */
.doh-warning { background-color: #ffffcc; } /* Light yellow for warning DOH */
</style>
</head>
<body>

<h1>Sales Data Analysis Report - 2024-11-27</h1>

<h2>Total Sales Analysis</h2>

<p><strong>Total Daily Sale:</strong> ₹208,772.00</p>
<p><strong>Previous Total Daily Sale:</strong> ₹215,400.00</p>
<p><strong>Percentage Change:</strong> <span class="negative">-3.08%</span> (Decline)</p>
<p><strong>Month-to-Date Total:</strong> ₹5,582,346.00</p>
<p>Daily sales show a 3.08% decline.  The Month-to-Date total needs further analysis relative to this daily trend. A detailed city and SKU-wise breakdown is crucial to understand the reasons for this decline.</p>


<h2>City and SKU-wise Sales Trends</h2>

<h3>Top Performing Cities and Products (Top 5)</h3>
<div id="topPerformers"></div>

<h3>Cities and SKUs with Highest Negative Changes</h3>
<div id="negativeChanges"></div>

<h3>Potential Future Sales Loss (DOH < 10 days)</h3>
<div id="lowDOH"></div>


<script>
const data = { /* ... Your data object ... */ };

function generateReportSection(selector, data, header, columns, filterFn = () => true) {
    const filteredData = data.filter(filterFn);
    if (filteredData.length === 0) return;

    let html = `<h3>${header}</h3><table><tr>`;
    columns.forEach(col => html += `<th>${col}</th>`);
    html += `</tr>`;

    filteredData.forEach(item => {
        html += `<tr>`;
        columns.forEach(col => {
            let value = item[col];
            let displayValue = value;
            let extraClass = '';

            if (col === 'PercentageChange') {
                displayValue = value + '%';
                displayValue = value >= 0 ? `<span class="positive">${displayValue}</span>` : `<span class="negative">${displayValue}</span>`;
            } else if (col === 'DaysOnHand' && value < 7) {
                extraClass = ' doh-critical'; // Critical: Less than 7 days
                displayValue += ' (Critical)';
            } else if (col === 'DaysOnHand' && value < 10) {
                extraClass = ' doh-warning'; // Warning: Less than 10 days
                displayValue += ' (Warning)';
            } else if (col === 'DaysOnHand' && value < 7 && item.PercentageChange <0){
                displayValue = `${value} (Critical - Potential reason for dip)`
            }
            html += `<td class="${extraClass}">${displayValue}</td>`;
        });
        html += `</tr>`;
    });
    html += `</table>`;
    document.getElementById(selector).innerHTML = html;
}

// Top Performers (Top 5)
const topN = 5;
const sortedCitySku = data.CitySkuWiseStats.sort((a, b) => b.Total - a.Total);
generateReportSection('topPerformers', sortedCitySku.slice(0, topN), 'Top Performing Cities & SKUs', ['city', 'sku', 'Total', 'PercentageChange', 'DaysOnHand']);

// Negative Changes (Negative PercentageChange)
generateReportSection('negativeChanges', data.CitySkuWiseStats, 'Cities & SKUs with Highest Negative Changes', ['city', 'sku', 'Total', 'PreviousTotal', 'PercentageChange', 'DaysOnHand'], item => item.PercentageChange < 0);

// Low DOH (DOH < 10 days)
generateReportSection('lowDOH', data.CitySkuWiseStats, 'Potential Future Sales Loss (DOH < 10 days)', ['city', 'sku', 'DaysOnHand'], item => item.DaysOnHand < 10);

</script>

</body>
</html>
